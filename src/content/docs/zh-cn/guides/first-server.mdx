---
title: åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ª Volar è¯­è¨€æœåŠ¡å™¨
description: æœ¬æŒ‡å—å°†æ•™ä½ å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„ Volar è¯­è¨€æœåŠ¡å™¨ã€‚
---

> è¿™ä¸ªé¡µé¢æ­£åœ¨ç¼–å†™ä¸­ã€‚æƒ³è¦ä¸ºå®ƒè´¡çŒ®ä¸€äº›æ–‡æ¡£, æˆ–è€…æƒ³è¦æ”¹è¿›å®ƒå—ï¼Ÿ[åœ¨ GitHub ä¸Šç¼–è¾‘è¿™ä¸ªé¡µé¢](https://github.com/volarjs/docs/blob/main/src/content/docs/guides/first-server.mdx)

import { Tabs, TabItem, Aside, FileTree } from "@astrojs/starlight/components";

åœ¨è¿™ä¸ªæŒ‡å—ä¸­, ä½ å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„ Volar è¯­è¨€æœåŠ¡å™¨å’Œ VS Code å®¢æˆ·ç«¯ã€‚ä¸ºäº†ä¿æŒç®€å•, è¿™ä¸ªè¯­è¨€å°†çœ‹èµ·æ¥éå¸¸åƒ HTML, å°½ç®¡æœ‰ä¸€ä¸ªå°å˜åŒ–: åªå…è®¸ä¸€ä¸ª `<style>` æ ‡ç­¾ã€‚è¿™ä¸ªè¯­è¨€å°†è¢«ç§°ä¸º `HTML1`ã€‚

è¿™ä¸ªæŒ‡å—å‡è®¾ä½ å¯¹ TypeScript å’Œ Node.js æœ‰åŸºæœ¬çš„äº†è§£, å¹¶ä¸”å¯¹ä»€ä¹ˆæ˜¯è¯­è¨€æœåŠ¡å™¨æœ‰ä¸€å®šçš„äº†è§£ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰è¯­è¨€æœåŠ¡å™¨, ä½ å¯èƒ½æƒ³è¦åœ¨ç»§ç»­ä¹‹å‰é˜…è¯» [Language Server Protocol](https://microsoft.github.io/language-server-protocol/) é¦–é¡µä¸Šçš„â€œä»€ä¹ˆæ˜¯è¯­è¨€æœåŠ¡å™¨åè®®ï¼Ÿâ€éƒ¨åˆ†ã€‚

> ğŸ’¡ æƒ³è¦ç›´æ¥å…‹éš†æ¨¡ç‰ˆé¡¹ç›®å—ï¼ŸæŸ¥çœ‹ GitHub ä¸Šçš„ [starter project](https://github.com/volarjs/starter) ã€‚

## å…ˆå†³æ¡ä»¶

- [Visual Studio Code](https://code.visualstudio.com/) v1.55 æˆ–ä»¥ä¸Šç‰ˆæœ¬.
- [Node.js](https://nodejs.org/en/) v14 æˆ–ä»¥ä¸Šç‰ˆæœ¬.
- å¯¹ JavaScript å’Œ Node.js çš„åŸºæœ¬äº†è§£.
- ï¼ˆå¯é€‰ï¼‰ä¸º VS Code å®‰è£… [Volar Labs](https://volarjs.dev/core-concepts/volar-labs/) æ‰©å±•.

## å¼€å§‹

é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ç›®å½•å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®: 

<Tabs>
<TabItem label="npm">

```sh
# ä½¿ç”¨ npm åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®
npm init
```

</TabItem>
<TabItem label="pnpm">

```sh
# ä½¿ç”¨ pnpm åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®
pnpm init
```

</TabItem>
<TabItem label="Yarn">

```sh
# ä½¿ç”¨ Yarn åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®
yarn init .
```

</TabItem>
</Tabs>

ä¸ºäº†èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªä»“åº“ä¸­åŒæ—¶æ‹¥æœ‰è¯­è¨€æœåŠ¡å™¨å’Œ VS Code å®¢æˆ·ç«¯, [è¯­è¨€æœåŠ¡å™¨çš„å¸¸è§æ¨¡å¼](/guides/file-structure)æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ `packages` ç›®å½•æ¥åŒ…å«è¿™ä¸¤ä¸ªéƒ¨åˆ†, è¿™å®é™…ä¸Šå°±æ˜¯æ‰€è°“çš„ monorepo (å¤šåŒ…ä»“åº“)ã€‚

<Tabs>
<TabItem label="npm">

```sh
# ä½¿ç”¨ npm åˆ›å»ºä¸€ä¸ªæ–° monorepo é¡¹ç›®
npm init -w ./packages/server
npm init -w ./packages/client
```

</TabItem>
<TabItem label="pnpm">

```sh
# ä½¿ç”¨ pnpm åˆ›å»ºä¸€ä¸ªæ–° monorepo é¡¹ç›®
mkdir -p ./packages/server ./packages/client
echo -e 'packages:\n  - "packages/*"' > pnpm-workspace.yaml
# è¿›å…¥ packages ä¸­æ–°åˆ›å»ºçš„ä¸¤ä¸ªæ–‡ä»¶å¤¹å¹¶è¿è¡Œ `pnpm init`
```

</TabItem>
<TabItem label="Yarn">

```sh
# ä½¿ç”¨ Yarn åˆ›å»ºä¸€ä¸ªæ–° monorepo é¡¹ç›®
yarn init -w ./packages/server
yarn init -w ./packages/client
```

</TabItem>
</Tabs>

<Aside type="note">
ä¸‹é¢å‡å®šä½ å°†å®¢æˆ·ç«¯å‘½åä¸º `vscode-html1`, æœåŠ¡å™¨ç«¯å‘½åä¸º `@html1/language-server`ã€‚

ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½å‘½åå®ƒä»¬, ä½†è¯·ç¡®ä¿åœ¨åç»­æ“ä½œä¸­ç›¸åº”åœ°è°ƒæ•´æŒ‡å—ä¸­çš„å†…å®¹ã€‚

</Aside>

### å®‰è£…å’Œé…ç½® TypeScript

åœ¨æœ¬æŒ‡å—çš„åé¢éƒ¨åˆ†, å°†ä½¿ç”¨ TypeScript æ¥ç¼–å†™è¯­è¨€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯, å¹¶å°† TypeScript ä»£ç ç¼–è¯‘ä¸º JavaScript, å› æ­¤æˆ‘ä»¬ç°åœ¨å°†å…¶å®‰è£…ã€‚

<Tabs>
<TabItem label="npm">

```sh
# ä½¿ç”¨ npm å®‰è£… TypeScript
npm install --save-dev typescript
```

</TabItem>
<TabItem label="pnpm">

```sh
# ä½¿ç”¨ pnpm å®‰è£… TypeScript
pnpm add --save-dev typescript
```

</TabItem>
<TabItem label="Yarn">

```sh
# ä½¿ç”¨ Yarn å®‰è£… TypeScript
yarn add --dev typescript
```

</TabItem>
</Tabs>

æ­¤å¤–, æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„ TypeScript é…ç½®æ–‡ä»¶, è¯¥æ–‡ä»¶å°†åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å…±äº«ã€‚æ­¤æ–‡ä»¶å°†ç”¨äºè®¾ç½®ä¸¤ä¸ªé¡¹ç›®éƒ¨åˆ†çš„å…±åŒ TypeScript ç¼–è¯‘å™¨é€‰é¡¹ã€‚

```json title="tsconfig.base.json"
{
  "compilerOptions": {
    "module": "nodenext"
  }
}
```

### å®šä¹‰ VS Code ä»»åŠ¡

æœ€å, åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª `.vscode` ç›®å½•, å¹¶å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ª `launch.json` æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶å®šä¹‰äº† [ä¸€ä¸ªä»»åŠ¡](https://code.visualstudio.com/docs/editor/tasks#_typescript-hello-world), å¯ä»¥åœ¨åç»­è½»æ¾å¯åŠ¨æ‰©å±•ã€‚

```json title=".vscode/launch.json"
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Extension",
      "type": "extensionHost",
      "request": "launch",
      "runtimeExecutable": "${execPath}",
      "args": [
        "--disable-updates",
        "--disable-workspace-trust",
        "--profile-temp",
        "--skip-release-notes",
        "--skip-welcome",
        "--extensionDevelopmentPath=${workspaceFolder}/packages/client"
      ],
      "outFiles": ["${workspaceFolder}/packages/client/dist/*.js"]
    }
  ]
}
```

å½“æ‰€æœ‰è¿™äº›å®Œæˆå, ä½ çš„é¡¹ç›®ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º: 

<FileTree>

- .vscode/
  - launch.json
- packages/
  - client/
    - package.json
  - server/
    - package.json
- package.json
- tsconfig.base.json

</FileTree>

## åˆ›å»ºå®¢æˆ·ç«¯

å®¢æˆ·ç«¯å°†æ˜¯ä¸€ä¸ª VS Code æ‰©å±•, è¿™éœ€è¦ [ä¸€ä¸ª `package.json` æ–‡ä»¶, åŒ…å«ä¸€äº›ç‰¹å®šå­—æ®µ](https://code.visualstudio.com/api/references/extension-manifest)ã€‚åœ¨ `packages/client` æ–‡ä»¶å¤¹ä¸­, ç¼–è¾‘ `package.json` æ–‡ä»¶, ä½¿å…¶å¦‚ä¸‹æ‰€ç¤º: 

```json title="packages/client/package.json"
{
  "name": "vscode-html1",
  "displayName": "HTML1 Client",
  "description": "A VS Code extension for HTML1.",
  "version": "0.0.1",
  "engines": {
    "vscode": "^1.55.0"
  },
  "activationEvents": ["onLanguage:html1"],
  "main": "./src/extension.js",
  "contributes": {
    "languages": [
      {
        "id": "html1",
        "extensions": [".html1"]
      }
    ]
  }
}
```

æ­¤å¤–, è¿˜éœ€è¦ä¸€äº›æ¥è‡ª Volar å’Œ VS Code çš„ä¾èµ–é¡¹ã€‚ç¡®ä¿ä½ åœ¨æ­£ç¡®çš„æ–‡ä»¶å¤¹ä¸­ï¼ˆ`packages/client`ï¼‰, å¹¶é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–é¡¹: 

<Tabs>
<TabItem label="npm">

```sh
# ä½¿ç”¨ npm å®‰è£…ä¾èµ–é¡¹
npm install @volar/language-server @volar/vscode vscode-languageclient @types/vscode ../server
```

</TabItem>
<TabItem label="pnpm">

```sh
# ä½¿ç”¨ pnpm å®‰è£…ä¾èµ–é¡¹
pnpm install @volar/language-server @volar/vscode vscode-languageclient @types/vscode ../server
```

</TabItem>
<TabItem label="Yarn">

```sh
# ä½¿ç”¨ Yarn å®‰è£…ä¾èµ–é¡¹
yarn add @volar/language-server @volar/vscode vscode-languageclient @types/vscode ../server
```

</TabItem>
</Tabs>

ä¸‹ä¸€æ­¥, åœ¨ `packages/client` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª `tsconfig.json` æ–‡ä»¶æ¥é…ç½® TypeScript, è¿™å°†åœ¨æœ¬æŒ‡å—ä¸­ç”¨ä½œæ„å»ºå·¥å…·ã€‚æ­¤æ–‡ä»¶å°†å‘Šè¯‰ TypeScript å°†ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶è¾“å‡ºåˆ° `out` ç›®å½•ã€‚

å¦‚å‰æ‰€è¿°, è¿™ä¸ªæ–‡ä»¶ä¼šç»§æ‰¿ä¹‹å‰åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºçš„ `tsconfig.base.json` åŸºç¡€é…ç½®ã€‚

```jsonc title="packages/client/tsconfig.json"
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "out",
    "rootDir": "src",
  },
  "include": ["src"],
}
```

ç„¶å, åœ¨ `packages/client` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ `src` ç›®å½•, å¹¶å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ `extension.ts` æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶å°†åŒ…å«å®¢æˆ·ç«¯æ‰©å±•çš„ä»£ç ã€‚

è¿™æ®µä»£ç çš„å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨äºå¯åŠ¨è¯­è¨€æœåŠ¡å™¨çš„æ ·æ¿ä»£ç , è™½ç„¶çœ‹èµ·æ¥å†…å®¹å¾ˆå¤šä¸”ä¸å¤ªæœ‰è¶£, ä½†å®ƒå¯¹äºæ‰©å±•çš„æ­£å¸¸è¿è¡Œè‡³å…³é‡è¦ã€‚

```ts title="packages/client/src/extension.ts"
import * as serverProtocol from "@volar/language-server/protocol";
import { activateAutoInsertion, createLabsInfo } from "@volar/vscode";
import * as vscode from "vscode";
import * as lsp from "vscode-languageclient/node";

let client: lsp.BaseLanguageClient;

// å¦‚å…¶åç§°æ‰€ç¤º, æ­¤å‡½æ•°åœ¨æ‰©å±•è¢«æ¿€æ´»æ—¶è°ƒç”¨ã€‚
export async function activate(context: vscode.ExtensionContext) {
  const serverModule = vscode.Uri.joinPath(
    context.extensionUri,
    "node_modules",
    "@html1/language-server",
    "dist",
    "server.js",
  );
  const serverOptions: lsp.ServerOptions = {
    run: {
      module: serverModule.fsPath,
      transport: lsp.TransportKind.ipc,
      options: { execArgv: <string[]>[] },
    },
    debug: {
      module: serverModule.fsPath,
      transport: lsp.TransportKind.ipc,
      options: { execArgv: ["--nolazy", "--inspect=" + 6009] },
    },
  };

  // ç”¨äºæ§åˆ¶è¯­è¨€å®¢æˆ·ç«¯çš„é€‰é¡¹, è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ HTML1 æ–‡ä»¶ã€‚
  // è¯­è¨€æœåŠ¡å™¨ä¹Ÿå¯ä»¥æ¥å—åˆå§‹åŒ–é€‰é¡¹, è¿™äº›é€‰é¡¹ä¼šåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ä¼ é€’, 
  // ä½†è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰éœ€è¦ä¼ é€’çš„å†…å®¹ã€‚
  const clientOptions: lsp.LanguageClientOptions = {
    documentSelector: [{ language: "html1" }],
    initializationOptions: {},
  };

  // ä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„æ‰€æœ‰é€‰é¡¹, åˆ›å»ºè¯­è¨€å®¢æˆ·ç«¯, å¹¶å¯åŠ¨å®ƒã€‚
  client = new lsp.LanguageClient(
    "html1-language-server",
    "HTML1 Language Server",
    serverOptions,
    clientOptions,
  );
  await client.start();

  // é¢å¤–çš„: ä¸ºè‡ªåŠ¨æ’å…¥é—­åˆæ ‡ç­¾æä¾›æ”¯æŒï¼ˆä¾‹å¦‚: <div> -> <div></div>ï¼‰
  activateAutoInsertion("html1", client);

  // æ·»åŠ è¯¥ä»£ç ä»¥æ·»åŠ å¯¹ Volar Labs çš„æ”¯æŒ
  // https://volarjs.dev/core-concepts/volar-labs/
  const labsInfo = createLabsInfo(serverProtocol);
  labsInfo.addLanguageClient(client);
  return labsInfo.extensionExports;
}

// ... å½“æ‰©å±•è¢«åœç”¨æ—¶ä¼šè°ƒç”¨æ­¤å‡½æ•°ï¼
export function deactivate(): Thenable<any> | undefined {
  return client?.stop();
}
```

<Aside type="note">
ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°, ä¸Šé¢çš„ä»£ç å¯¼å…¥äº† `vscode`, å°½ç®¡å¹¶æ²¡æœ‰å®‰è£…å®ƒã€‚è¿™æ˜¯å› ä¸º `vscode` æ¨¡å—æ˜¯ç”± VS Code æœ¬èº«æä¾›çš„, å¹¶ä¸”é»˜è®¤å¯¹æ‰©å±•å¯ç”¨ã€‚

æœ‰å…³æ­¤æ¨¡å—åŠå…¶å†…å®¹çš„æ›´å¤šä¿¡æ¯, è¯·æŸ¥çœ‹ [VS Code API æ–‡æ¡£](https://code.visualstudio.com/api/references/vscode-api)ã€‚

</Aside>

ç°åœ¨å®¢æˆ·ç«¯å·²ç»å®Œæˆã€‚ç”±äºç»å¤§å¤šæ•°å®é™…é€»è¾‘å°†åœ¨è¯­è¨€æœåŠ¡å™¨ä¸­, å› æ­¤å³ä½¿éšç€é¡¹ç›®å¤æ‚æ€§çš„å¢é•¿, æ‚¨ä¹Ÿä¸å¤ªå¯èƒ½éœ€è¦å†æ¬¡è®¿é—®å®¢æˆ·ç«¯ã€‚

ä½ çš„é¡¹ç›®ç»“æ„ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„: 

<FileTree>

- .vscode/
  - launch.json
- packages/
  - client/
    - src/
      - extension.ts
    - package.json
    - tsconfig.json
  - server/
    - package.json
- package.json
- tsconfig.base.json

</FileTree>

å¦‚æœä½ éå¸¸å¥½å¥‡, ä½ å¯ä»¥é€šè¿‡åœ¨ VS Code ä¸­è¿è¡Œ `Launch Extension` ä»»åŠ¡æ¥ç«‹å³å¯åŠ¨å®¢æˆ·ç«¯ã€‚

ç”±äºæœåŠ¡å™¨å°šä¸å­˜åœ¨, å› æ­¤å®¢æˆ·ç«¯å°†æ— æ³•å¯åŠ¨å¹¶ç«‹å³å´©æºƒ, ä½†è¿™å°†æ˜¯æˆ‘ä»¬çš„ä¸€ä¸ªå¼€å§‹ï¼

## æœåŠ¡å™¨

ç°åœ¨è¿›å…¥é¡¹ç›®çš„æ ¸å¿ƒéƒ¨åˆ†: è¯­è¨€æœåŠ¡å™¨ã€‚æœ¬èŠ‚çš„å¤§éƒ¨åˆ†å†…å®¹å°†èŠ±è´¹åœ¨è¿æ¥å„ä¸ªéƒ¨åˆ†ä¸Š, è€Œä¸æ˜¯ç¼–å†™å®é™…çš„é€»è¾‘ã€‚å®é™…çš„é€»è¾‘å°†éå¸¸ç®€å•, å› ä¸ºæˆ‘ä»¬æ”¯æŒçš„è¯­è¨€ä¹Ÿç›¸å½“ç®€å•ã€‚

é¦–å…ˆ, æˆ‘ä»¬å°†å®‰è£…ä¸€äº›ä¾èµ–é¡¹, å°±åƒæˆ‘ä»¬ä¸ºå®¢æˆ·ç«¯æ‰€åšçš„é‚£æ ·ã€‚ç¡®ä¿æ‚¨åœ¨æ­£ç¡®çš„æ–‡ä»¶å¤¹ï¼ˆ`packages/server`ï¼‰ä¸­, å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤: 

<Tabs>
<TabItem label="npm">

```sh
# ä½¿ç”¨ npm å®‰è£…ä¾èµ–é¡¹
npm install @volar/language-server @volar/language-core @volar/language-service volar-service-html volar-service-css vscode-html-languageservice
```

</TabItem>

<TabItem label="pnpm">

```sh
# ä½¿ç”¨ pnpm å®‰è£…ä¾èµ–é¡¹
pnpm install @volar/language-server @volar/language-core @volar/language-service volar-service-html volar-service-css vscode-html-languageservice
```

</TabItem>

<TabItem label="Yarn">

```sh
# ä½¿ç”¨ yarn å®‰è£…ä¾èµ–é¡¹
yarn add @volar/language-server @volar/language-core @volar/language-service volar-service-html volar-service-css vscode-html-languageservice
```

</TabItem>
</Tabs>

ä¸å®¢æˆ·ç«¯ä¸€æ ·, åœ¨ `packages/server` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª `tsconfig.json` æ–‡ä»¶ä»¥é…ç½® TypeScriptã€‚æ­¤æ–‡ä»¶å°†å‘Šè¯‰ TypeScript å°†ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶è¾“å‡ºåˆ° `dist` ç›®å½•ã€‚

```jsonc title="packages/server/tsconfig.json"
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "out",
    "rootDir": "src",
  },
  "include": ["src"],
}
```

ç”±äºè¯­è¨€æœåŠ¡å™¨æ˜¯å¯æ‰§è¡Œç¨‹åº, æˆ‘ä»¬éœ€è¦ä¸ºæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªå…¥å£ç‚¹ã€‚åœ¨ `packages/server` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ `bin` ç›®å½•, å¹¶æ·»åŠ ä¸€ä¸ªåä¸º `html1-language-server.js` çš„æ–‡ä»¶ã€‚

è¿™ä¸ªæ–‡ä»¶å°†åŒ…å«ä¸€å°æ®µä»£ç , ç”¨äºå¯åŠ¨è¯­è¨€æœåŠ¡å™¨ã€‚

```ts title="packages/server/bin/html1-language-server.js"
#!/usr/bin/env node
if (process.argv.includes("--version")) {
  const pkgJSON = require("../package.json");
  console.log(`${pkgJSON["version"]}`);
} else {
  require("../out/index.js");
}
```

æˆ‘ä»¬è¿˜å°†æ›´æ–° `packages/server` æ–‡ä»¶å¤¹ä¸­çš„ `package.json` æ–‡ä»¶, ä»¥å°†æ­¤æ–‡ä»¶æ·»åŠ ä¸ºåŒ…æä¾›çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

```jsonc title="packages/server/package.json" ins={4-6}
{
  "name": "@html1/language-server",
  "version": "0.0.1",
  "bin": {
    "html1-language-server": "./bin/html1-language-server.js",
  },
  "dependencies": {
    // All your dependencies here...
  },
}
```

zh: ç°åœ¨, å®‰è£…æ‚¨çš„è½¯ä»¶åŒ…çš„äººå°†èƒ½å¤Ÿä½¿ç”¨ `html1-language-server` å‘½ä»¤è¿è¡ŒæœåŠ¡å™¨ã€‚å¦å¤–, æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è¿è¡Œ `html1-language-server --version` æ¥æ‰“å°æœåŠ¡å™¨çš„ç‰ˆæœ¬å·ã€‚

ç„¶è€Œ, æˆ‘ä»¬ä»ç„¶æ²¡æœ‰å®é™…å¯ä»¥å¯åŠ¨çš„æœåŠ¡å™¨ï¼åœ¨ `packages/server` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ `src` ç›®å½•, å¹¶åˆ›å»ºä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶: 

- `index.ts`: æœåŠ¡å™¨çš„å…¥å£ç‚¹, è¯¥æ–‡ä»¶å°†åˆ›å»ºã€é…ç½®å’Œå¯åŠ¨æœåŠ¡å™¨ã€‚
- `html1-service.ts`: å¤„ç† HTML1 è¯­è¨€çš„ [æœåŠ¡](/reference/services/)ã€‚
- `languagePlugin.ts`: HTML1 è¯­è¨€çš„ [è¯­è¨€å®šä¹‰](/reference/languages/)ã€‚

æ­¤æ—¶, æ‚¨çš„æ•´ä¸ªé¡¹ç›®ç»“æ„åº”å¦‚ä¸‹æ‰€ç¤º: 

<FileTree>

- .vscode/
  - launch.json
- packages/
  - client/
    - src/
      - extension.ts
    - package.json
    - tsconfig.json
  - server/
    - bin/
      - html1-language-server.js
    - src/
      - index.ts
      - html1-service.ts
      - languagePlugin.ts
    - package.json
    - tsconfig.json
- package.json
- tsconfig.base.json

</FileTree>

### é…ç½®æœåŠ¡å™¨

æˆ‘ä»¬å°†é¦–å…ˆè·³è½¬åˆ° `index.ts` æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å°†åˆ›å»ºæœåŠ¡å™¨, é…ç½®æ‰€æœ‰æ”¯æŒçš„è¯­è¨€å’Œå°†è¦ä½¿ç”¨çš„ä¸åŒæœåŠ¡, ç„¶åå¯åŠ¨æœåŠ¡å™¨ã€‚

```ts title="packages/server/src/index.ts"
import { html1LanguagePlugin, Html1Code } from "./languagePlugin";
import { create as createHtmlService } from "volar-service-html";
import { create as createCssService } from "volar-service-css";
import {
  createServer,
  createConnection,
  createSimpleProject,
} from "@volar/language-server/node";

const connection = createConnection();
const server = createServer(connection);

connection.listen();

connection.onInitialize((params) => {
  return server.initialize(
    params,
    createSimpleProject([
      // è¯­è¨€æ’ä»¶, ç›®å‰ä¸ºç©º
    ]),
    [
      createHtmlService(),
      createCssService(),
    ],
  );
});

connection.onInitialized(server.initialized);
connection.onShutdown(server.shutdown);
```

é¦–å…ˆ, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼ˆ`createConnection`ï¼‰, ç„¶ååˆ›å»ºæœåŠ¡å™¨æœ¬èº«ã€‚æ¥ç€, æˆ‘ä»¬ç›‘å¬è¿æ¥, ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚

ä¸€æ—¦è¿æ¥å®Œæˆ, æˆ‘ä»¬åˆå§‹åŒ–æœåŠ¡å™¨, åŒ…æ‹¬å…¶è¯­è¨€å’ŒæœåŠ¡æ’ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, æˆ‘ä»¬è¿˜æ²¡æœ‰ä»»ä½•è¯­è¨€æ’ä»¶, ä½†æˆ‘ä»¬ç¡®å®æœ‰ä¸¤ä¸ªæœåŠ¡æ’ä»¶: ä¸€ä¸ªç”¨äº HTML, ä¸€ä¸ªç”¨äº CSS, è¿™ä¸¤ç§è¯­è¨€éƒ½æ˜¯æˆ‘ä»¬çš„ HTML1 è¯­è¨€å°†æ”¯æŒçš„ã€‚

### å®šä¹‰è¯­è¨€

é¡¾åæ€ä¹‰, æˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬æ”¯æŒçš„è¯­è¨€ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, è¿™å°±æ˜¯ HTML1ã€‚ä½œä¸ºæé†’, HTML1 æ˜¯ HTML, ä½†é™åˆ¶ä¸ºä»…å…è®¸ä¸€ä¸ª `<style>` æ ‡ç­¾ï¼ˆæ­¤å¤–, å®ƒæ²¡æœ‰ `script` æ ‡ç­¾, ä½†æˆ‘ä»¬æš‚æ—¶å¿½ç•¥è¿™ä¸€ç‚¹ï¼‰ã€‚

è¯­è¨€å®šä¹‰çš„æ ¸å¿ƒåªæ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡, å…·æœ‰ä¸¤ä¸ªæ–¹æ³•: ä¸€ä¸ªç”¨äºåˆ›å»ºè™šæ‹Ÿä»£ç , ä¸€ä¸ªç”¨äºæ›´æ–°å®ƒã€‚è™šæ‹Ÿä»£ç ï¼ˆ`VirtualCode`ï¼‰æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¯­è¨€æœåŠ¡å™¨ä¸­æ–‡ä»¶çš„å¯¹è±¡, ç”¨äºå­˜å‚¨æœ‰å…³æ–‡ä»¶çš„ä¿¡æ¯, ä¾‹å¦‚å…¶å†…å®¹ã€å½“å‰ç‰ˆæœ¬ä»¥åŠå¯èƒ½æœ‰ç”¨çš„ä»»ä½•å…¶ä»–å…ƒæ•°æ®ã€‚

æ¯ä¸ªè¯­è¨€æœåŠ¡å™¨å¤„ç†çš„æ–‡ä»¶éƒ½å°†å…·æœ‰ä¸€ä¸ªå¯¹åº”çš„ `VirtualCode` å¯¹è±¡ã€‚è¯­è¨€æœåŠ¡å™¨å°†åœ¨æ–‡ä»¶æ‰“å¼€æ—¶åˆ›å»ºè¿™äº›å¯¹è±¡, å¹¶åœ¨æ–‡ä»¶æ›´æ”¹æ—¶æ›´æ–°å®ƒä»¬ã€‚

```ts title="packages/server/src/languagePlugin.ts"
import type { LanguagePlugin } from "@volar/language-core";
import type { URI } from "vscode-uri";

export const language = {
  getLanguageId(uri) {
    if (uri.path.endsWith('.html1')) {
      return 'html1';
    }
  },
  createVirtualCode(uri, languageId, snapshot) {
    // åœ¨è¿™é‡Œåˆ›å»ºè™šæ‹Ÿä»£ç å¯¹è±¡
  },
  updateVirtualCode(uri, languageCode, snapshot) {
    // æ›´æ–°è™šæ‹Ÿä»£ç å¯¹è±¡æ—¶ä¼šè¢«è°ƒç”¨
  },
} satisfies LanguagePlugin<URI>;
```

è™½ç„¶ `VirtualCode` å¯¹è±¡å¯ä»¥æ˜¯æ™®é€šçš„ JavaScript å¯¹è±¡, ä½†é€šå¸¸åˆ›å»ºä¸€ä¸ª JavaScript ç±»æ¥è¡¨ç¤ºå®ƒä»¬æ˜¯æœ‰ç”¨çš„ã€‚è¿™ä¸ªç±»å¯ä»¥åŒ…å«å¤„ç†æ–‡ä»¶åŠå…¶ç›¸å…³æ•°æ®æ—¶æœ‰ç”¨çš„æ–¹æ³•å’Œå±æ€§ã€‚

```ts title="packages/server/src/languagePlugin.ts" ins={3, 12-14, 17-18, 22-99} ins=/(VirtualCode) }/
import type { LanguagePlugin, VirtualCode } from "@volar/language-core";
import type { URI } from "vscode-uri";
import type * as ts from 'typescript';

export const language = {
  getLanguageId(uri) {
    if (uri.path.endsWith('.html1')) {
      return 'html1';
    }
  },
  createVirtualCode(uri, languageId, snapshot) {
    if (languageId === "html1") {
      return new Html1Code(snapshot);
    }
  },
  updateVirtualCode(uri, languageCode, snapshot) {
    languageCode.update(snapshot);
    return languageCode;
  },
} satisfies LanguagePlugin<URI>;

export class Html1Code implements VirtualCode {
  id = "root";
  languageId = "html1";
  embeddedCodes: VirtualCode[] = [];

  constructor(public snapshot: ts.IScriptSnapshot) {
    this.onSnapshotUpdated();
  }

  public update(newSnapshot: ts.IScriptSnapshot) {
    this.snapshot = newSnapshot;
    this.onSnapshotUpdated();
  }

  public onSnapshotUpdated() {
    // åœ¨è¿™é‡Œå¤„ç†å¿«ç…§æ›´æ–°é€»è¾‘
  }
}
```

è¿™ä¸ªæ–¹æ³•å°†åŒ…å«åœ¨æ–‡ä»¶æ›´æ–°æ—¶æ‰§è¡Œçš„æ‰€æœ‰é€»è¾‘ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, æˆ‘ä»¬å°†ä½¿ç”¨æ­¤æ–¹æ³•æ¥è§£ææ–‡ä»¶å¹¶ç†è§£å…¶ç»“æ„å’Œå†…å®¹ã€‚

ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ° `Html1Code` ç±»æœ‰ä¸€ä¸ª `embeddedCodes` å±æ€§ã€‚è¿™ä¸ªå±æ€§ç”¨äºå­˜å‚¨æ–‡ä»¶å¯èƒ½åŒ…å«çš„ [åµŒå…¥å¼è¯­è¨€](/core-concepts/embedded-languages) çš„ä»»ä½•åµŒå…¥å¼ `VirtualCode`ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, HTML1 å°†åŒ…å«ä¸¤ç§åµŒå…¥å¼è¯­è¨€: HTML å’Œ CSSã€‚è¦æ‰¾åˆ°è¿™äº›åµŒå…¥å¼è¯­è¨€çš„ä½ç½®, æˆ‘ä»¬éœ€è¦è§£ææ–‡ä»¶å¹¶æŸ¥æ‰¾ `<style>` æ ‡ç­¾ã€‚å½“æˆ‘ä»¬æ‰¾åˆ°å®ƒæ—¶, æˆ‘ä»¬å°†ä¸º HTML å’Œ CSS ä»£ç åˆ›å»ºä¸€ä¸ªæ–°çš„ `VirtualCode` å¯¹è±¡, å¹¶å°†å…¶æ·»åŠ åˆ° `embeddedCodes` æ•°ç»„ä¸­ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ `vscode-html-languageservice` åŒ…æ¥è§£æ HTML å’Œ CSS ä»£ç , è¿™ä¸ªåŒ…ä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹å‰æ·»åŠ åˆ°æœåŠ¡å™¨çš„ HTML æœåŠ¡æ‰€ä½¿ç”¨çš„ã€‚
